#!/usr/bin/env python3
"""ä½¿ç”¨ MCP å‘å¸ƒ API ç›´æ¥å‘å¸ƒå†…å®¹"""

import requests
import base64

BASE_URL = "http://localhost:18060"

# è¯»å–å›¾ç‰‡å¹¶è½¬æ¢ä¸º base64
image_path = "/tmp/test_cover.jpg"
with open(image_path, "rb") as f:
    image_base64 = base64.b64encode(f.read()).decode("utf-8")

print(f"âœ… å›¾ç‰‡å·²è¯»å–: {len(image_base64)} bytes (base64)")

# å‡†å¤‡å‘å¸ƒæ•°æ®
data = {
    "title": "ç¾é™¢å­¦ç”Ÿéƒ½åœ¨ç”¨AIï¼Ÿæˆ‘å°±ç¬‘äº†",
    "content": """åˆ·åˆ°ä¸€æ¡ç¬”è®°ï¼Œè¯´ä»€ä¹ˆ"ç¾é™¢å­¦ç”Ÿå¸¸ç”¨çš„AIè§†é¢‘å·¥å…·å¤§åˆé›†"ã€‚æˆ‘å°±ç¬‘äº†ã€‚

è¿™äº›å·¥å…·æ˜¯å¹²å˜›çš„ï¼Ÿå¸®ä½ çœäº‹å„¿çš„ã€‚å¸®ä½ è·³è¿‡æ‰‹ç»˜ã€æ„å›¾ã€è‰²å½©è®­ç»ƒé‚£äº›æ¯ç‡¥çš„ä¸œè¥¿ã€‚

é—®é¢˜æ˜¯ï¼šç¾é™¢å­¦ç”Ÿä¸å­¦åŸºæœ¬åŠŸï¼Œä»¥åæ‹¿ä»€ä¹ˆåƒé¥­ï¼Ÿ

AI èƒ½å¸®ä½ å‡ºä¸€å¼ å›¾ï¼Œèƒ½å¸®ä½ åšä¸€æ¡è§†é¢‘ã€‚ä½†å®ƒèƒ½æ•™ä½ æ€ä¹ˆé…è‰²å—ï¼Ÿèƒ½å‘Šè¯‰ä½ ä¸ºä»€ä¹ˆè¿™å¹…ç”»çœ‹ç€èˆ’æœå—ï¼Ÿ

ç°åœ¨ä¸€ä¸ªä¸ªéƒ½åœ¨ç‚«è€€ä¼šç”¨å¤šå°‘ AI å·¥å…·ã€‚æˆ‘å°±é—®ä¸€å¥ï¼šç¦»å¼€è¿™äº›å·¥å…·ï¼Œä½ è¿˜å‰©ä»€ä¹ˆï¼Ÿ

å½“å¹´è¾¾èŠ¬å¥‡ç”»é¸¡è›‹çš„æ—¶å€™ï¼Œå¯æ²¡æœ‰ä»€ä¹ˆ AI å¸®ä»–çœäº‹ã€‚åŸºæœ¬åŠŸè¿™ä¸œè¥¿ï¼Œæ²¡å¾—çœã€‚

ä»¥åå¸‚åœºä¸Šä¸ç¼ºä¼šå†™æç¤ºè¯çš„äººï¼Œç¼ºçš„æ˜¯çœŸæ­£æ‡‚ç¾å­¦ã€æ‡‚è®¾è®¡è¯­è¨€çš„äººã€‚

ä½ èŠ±æ—¶é—´å­¦ AI å·¥å…·ï¼Œä¸å¦‚èŠ±æ—¶é—´ç”»ä¸¤å¼ é€Ÿå†™ã€‚

ä»¥ä¸Šã€‚

#AIå·¥å…· #ç¾é™¢ #è®¾è®¡ #åŸºæœ¬åŠŸ""",
    "images": [image_base64]  # ä½¿ç”¨ base64 ç¼–ç çš„å›¾ç‰‡
}

print("ğŸ“¤ å‡†å¤‡å‘å¸ƒ...")
print(f"   æ ‡é¢˜: {data['title']}")
print(f"   å†…å®¹é•¿åº¦: {len(data['content'])} å­—ç¬¦")
print(f"   å›¾ç‰‡: 1 å¼  ({len(image_base64)} bytes base64)")

# å‘å¸ƒ
try:
    resp = requests.post(
        f"{BASE_URL}/api/v1/publish",
        json=data,
        timeout=120
    )

    print(f"\nğŸ“¡ API å“åº”çŠ¶æ€: {resp.status_code}")
    print(f"   å“åº”å†…å®¹: {resp.text[:200]}")

    result = resp.json()
    if result.get("success"):
        print(f"\nğŸ‰ å‘å¸ƒæˆåŠŸï¼")
        print(f"   Post ID: {result.get('data', {}).get('post_id', 'Unknown')}")
    else:
        print(f"\nâŒ å‘å¸ƒå¤±è´¥: {result.get('error', 'Unknown error')}")

except Exception as e:
    print(f"\nâŒ é”™è¯¯: {e}")
